name: CI Test
on:
  push:
    branches: [ main, dev ]
  pull_request:

jobs:
  test:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    steps:
      # âœ… Quiz 1 - ì´ë²¤íŠ¸ íƒ€ìž… ë° ë¸Œëžœì¹˜ í‘œì‹œ
      - name: Print Trigger Info
        run: |
          echo "===== [Quiz 1] ì´ë²¤íŠ¸ ì •ë³´ í™•ì¸ ====="
          echo "ðŸ”¹ ì´ë²¤íŠ¸ íƒ€ìž…: ${{ github.event_name }}"
          echo "ðŸ”¹ ë¸Œëžœì¹˜: ${{ github.ref_name }}"
          echo "====================================="

      # âœ… ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout Repository
        uses: actions/checkout@v4

      # âœ… Node.js ì„¤ì •
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # âœ… Quiz 3 - Node.js ë²„ì „ í™•ì¸
      - name: Check Node Version
        run: |
          echo "===== [Quiz 3] Node.js ë²„ì „ í™•ì¸ ====="
          node -v
          echo "====================================="

      # âœ… package.json ì—¬ë¶€ í™•ì¸ í›„ npm install
      - name: Install Dependencies
        run: |
          if [ -f package.json ]; then
            echo "ðŸ“¦ package.json detected â†’ Installing dependencies..."
            npm install
          else
            echo "âš ï¸ No package.json found â†’ Skipping installation"
          fi

      # âœ… í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      - name: Run Test Script
        run: |
          if npm run | grep -q "test"; then
            echo "ðŸš€ Running npm test..."
            npm test
          else
            echo "âš ï¸ No test script found â†’ Skipping test"
          fi

      # âœ… Quiz 2 - GITHUB_ENV ê°’ ì €ìž¥ ë° ì¶œë ¥
      - name: Save Test Result
        run: |
          echo "RESULT=SUCCESS" >> $GITHUB_ENV

      - name: Display Test Result
        run: |
          echo "===== [Quiz 2] GITHUB_ENV ì¶œë ¥ ====="
          echo "í…ŒìŠ¤íŠ¸ ê²°ê³¼: $RESULT"
          echo "==================================="
