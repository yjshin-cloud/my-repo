name: CI Test
on:
  push:
    branches: [ main, dev ]
  pull_request:

jobs:
  test:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    steps:
      # âœ… 1. push / pull_request íŠ¸ë¦¬ê±° í™•ì¸ìš© ë¡œê·¸
      - name: Print Trigger Info
        run: |
          echo "ğŸ”¹ ì´ë²¤íŠ¸ íƒ€ì…: ${{ github.event_name }}"
          echo "ğŸ”¹ ë¸Œëœì¹˜: ${{ github.ref_name }}"

      # âœ… 2. ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout Repository
        uses: actions/checkout@v4

      # âœ… 3. Node.js 20 ë²„ì „ ì„¤ì •
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Check Node Version
        run: node -v  # => Quiz 3 í™•ì¸ (v20.x.x ì¶œë ¥)

      # âœ… 4. íŒ¨í‚¤ì§€ ì„¤ì¹˜ (package.jsonì´ ìˆì„ ê²½ìš°ë§Œ)
      - name: Install Dependencies
        run: |
          if [ -f package.json ]; then
            echo "ğŸ“¦ package.json detected â†’ Installing dependencies..."
            npm install
          else
            echo "âš ï¸ No package.json found, skipping npm install"
          fi

      # âœ… 5. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ìˆì„ ê²½ìš°)
      - name: Run Test Script
        run: |
          if npm run | grep -q "test"; then
            echo "ğŸš€ Running npm test..."
            npm test
          else
            echo "âš ï¸ No test script found, skipping test"
          fi

      # âœ… 6. í™˜ê²½ ë³€ìˆ˜ì— í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥
      - name: Save Test Result
        run: echo "RESULT=SUCCESS" >> $GITHUB_ENV

      # âœ… 7. GITHUB_ENV ê²°ê³¼ ì¶œë ¥ (Quiz 2 í™•ì¸)
      - name: Display Test Result
        run: echo "í…ŒìŠ¤íŠ¸ ê²°ê³¼: $RESULT"
